vault operator raft join -address=http://vault-1.vault-internal:8200  http://vault-0.vault-internal:8200


vault write auth/kubernetes/role/demo \
    bound_service_account_names=vault \
    bound_service_account_namespaces=vault \
    policies=default \
    ttl=1h


 KUBE_TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)
 curl --request POST --data '{"jwt": "'"$KUBE_TOKEN"'", "role": "demo"}' $VAULT_ADDR/v1/auth/kubernetes/login

vault write auth/kubernetes/config \
     token_reviewer_jwt="eyJhbGciOiJSUzI1NiIsImtpZCI6Ik5NcF9fYkIwd3lYLWgxMmVPLXFwdEtIWkhYU2tfaXlXbGVDa2JvaXFmcjAifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InZhdWx0LWF1dGgtc2VjcmV0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6InZhdWx0LWF1dGgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIxZjI1YWQ0ZC0yZjdhLTRjNTAtOGRlMy0yZDIyM2M3MzRmNGEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVmYXVsdDp2YXVsdC1hdXRoIn0.rhYXHhw0UzaWjVJlwsU3PrWouLzU6sCw4q9RItMnWYiI-QRV2AN8WJMtaoEu1ZoPBEq6tDJkczAsz5XTR1PVVO5JTEN3FVZjAct1EQ7kimYVSWdU3eMR0ZdKP8C0lWGLz7Bzpm4YFJYAgE653iUIMBEMcYpNNVuSJM8eQQ_Bo__1i1loqWKkeQdeL8zf1MajnKXZpSROzclELSKljLyArRs6MisNWc_YahHMeIAMmbVKu8grD0bnb4MkvfQQ3atjQJMkLLAvCdx-LrnfAgRjacTQcUc01aTrQEjxzzvdZggHPcmqBVydVHs8NROFXh-5JQCOvsgJoWfIpMRlsOsoPN7hcvyo4ysJJDHelaOGShT9R5vDX09KFEGaQNtXadTDH6brf52Mo4C-tE70qHD3oHFxBKuTZugzzQHA6w_iCd-OrQ_ERbC_Erl34avz8fhWKJFZ7fTnONCTJ75LCohv6yATr46qB6d3yIw1mI4ZWcND_KXzwi81P0G0Qd-3KznMr5zwEuUVqFfGpS5_qmQk-ngGZl7zHnrzymkJ11z5ilqTyvIRyOCo0uweKQmDQILqMxXYzaF07iCzACKOlSwOIz169zDPv-eJW87uRxCgTd1YxvlXopeImoJvru9q5N_hNYJffYZfbRRbr63nP6Bo_dqg1CevSWLisgdy1QPUWx0" \
     kubernetes_host="https://api.crc.testing:6443" \
     kubernetes_ca_cert="-----BEGIN CERTIFICATE-----
MIIDWzCCAkOgAwIBAgIIB6FEMyC0WKkwDQYJKoZIhvcNAQELBQAwJjEkMCIGA1UE
AwwbaW5ncmVzcy1vcGVyYXRvckAxNjc1NzQyNjI4MB4XDTIzMDIwNzA0MDM0OFoX
DTI1MDIwNjA0MDM0OVowHTEbMBkGA1UEAwwSKi5hcHBzLWNyYy50ZXN0aW5nMIIB
IjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0HuzNPYY827adVsqahiu4JJ0
KYAoTssMxrlRLP63EHFrZsu4jPuNUEBsFeor8mHvclrtY0VKEXmIMU6Y3SQaeOz7
xwfpjuy50r5UPYVrtwWxb6krEpUIrXIOwuxnOS0mX4pXz5rvzgSlFgh3jcqR+tq2
+bqbgjFM2V3tD558s8b9sCzC/QyC5CT5UJ1nqpY8aujCmbY0gwRojHXrh/iHupJr
T2d2vKOwouAMWrDL1sfkkvZ+2xRnGxH6pKZI8sKYXk5a9JDZv6Zz42Hpqsm8WSXq
hAkriTtiKsRY/LUwEMrobsVXECd9lmBFbhCRtvsyzAE8od6fCjTDhKN2iprEbQID
AQABo4GVMIGSMA4GA1UdDwEB/wQEAwIFoDATBgNVHSUEDDAKBggrBgEFBQcDATAM
BgNVHRMBAf8EAjAAMB0GA1UdDgQWBBS6+gMY818Pp8xhCesKEQMM4DyQUDAfBgNV
HSMEGDAWgBSgjXTwjh3EXSfzClruDxble1H3rzAdBgNVHREEFjAUghIqLmFwcHMt
Y3JjLnRlc3RpbmcwDQYJKoZIhvcNAQELBQADggEBAFLqT+vrGBE/eVwZJVd130j5
V/FHudbQZtwb+88igtmPxM04HUncAGexfAIysAuQ7qclLMzgQY050qomKvp/VX+N
IUNDVG31gOdS9JnL0bTQ3oGUahruCKPDKCg3Ic/op4+Zs6g9KPHEEBrWeYJwRJ5R
S6dWnTysvw138Gj6b8iu4S0TTG/cHAbxYq3n0t4XLnNiCTIdlo84VuG3c2ISqnpj
bxWFplcp64ZwNWcReHu9rT8Hj2boqX9QRlP0EAfwJ6CQ+bvpXKMHeJliyULm9b9u
aQx8Jw/dzAGThZpAp0nLZF/mz4AHc3WQ+dOx+GrKyf/fhOu2THZSIEQ5rZxTwdM=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDDDCCAfSgAwIBAgIBATANBgkqhkiG9w0BAQsFADAmMSQwIgYDVQQDDBtpbmdy
ZXNzLW9wZXJhdG9yQDE2NzU3NDI2MjgwHhcNMjMwMjA3MDQwMzQ3WhcNMjUwMjA2
MDQwMzQ4WjAmMSQwIgYDVQQDDBtpbmdyZXNzLW9wZXJhdG9yQDE2NzU3NDI2Mjgw
ggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCyBVzvAL8fa3JR5LlRG3W9
Vq9urdGUztYH/T+59sBrxy95vb1xeCRoiGIOBAnJ1Y6moZLtpTdEag/bEQgCwjhh
tRaT36JVeXSaQV2lLZ+ox7no9OYbOWqnM45ry+T4R06Ar3T/ZOnaIpAN2kUUuVrL
ekSlZuUoNjOtT63mopl25o1LTZFsGFuDrbuE19155dmXy4YxVUKnefyOxP5zWb42
vLKIe8VAuC3c96Q0Qxq5tfsUYCgEOnCP/BT57zVkG91r4JTUl091Y+ymCx4Q/nGZ
BCGvjooz53YKUHXpHHUjbRhiEhGiaowPnCOhoH8kxRCAM9I7KTPTQb5CEc+LSOLH
AgMBAAGjRTBDMA4GA1UdDwEB/wQEAwICpDASBgNVHRMBAf8ECDAGAQH/AgEAMB0G
A1UdDgQWBBSgjXTwjh3EXSfzClruDxble1H3rzANBgkqhkiG9w0BAQsFAAOCAQEA
WxgBjd2HcMNap3O8bqRKiCmH4jZfu3zQd7zUSmTpbUgQagog6ngcvPnDbCdr1s45
UaFXSW7oezG6XnQuXYqSgC2JW1n9CBo5YrtRbdpyTou1rJkRGPo7QOPBpnwKpIqm
n3o/cKviY4oRW8NZuNXlyPNnQAcjsrQUTQY5TiTIHnk6JE/OiFa80VP7hC+adz/d
ZyJT7TPAxHhICyPKkLGbCkj+abauKJsC6etaW5fU/aME3vw2r47ZtLIiZmY5rqYs
30lOY2j8hywwR5UJ1OVKGBAusXeyJddtBx6YjR79/vsAkRq7lOPJBPg3be7FQvoA
ve4ujNLo8Yf6M9CVfa0Lyg==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDWzCCAkOgAwIBAgIIB6FEMyC0WKkwDQYJKoZIhvcNAQELBQAwJjEkMCIGA1UE
AwwbaW5ncmVzcy1vcGVyYXRvckAxNjc1NzQyNjI4MB4XDTIzMDIwNzA0MDM0OFoX
DTI1MDIwNjA0MDM0OVowHTEbMBkGA1UEAwwSKi5hcHBzLWNyYy50ZXN0aW5nMIIB
IjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0HuzNPYY827adVsqahiu4JJ0
KYAoTssMxrlRLP63EHFrZsu4jPuNUEBsFeor8mHvclrtY0VKEXmIMU6Y3SQaeOz7
xwfpjuy50r5UPYVrtwWxb6krEpUIrXIOwuxnOS0mX4pXz5rvzgSlFgh3jcqR+tq2
+bqbgjFM2V3tD558s8b9sCzC/QyC5CT5UJ1nqpY8aujCmbY0gwRojHXrh/iHupJr
T2d2vKOwouAMWrDL1sfkkvZ+2xRnGxH6pKZI8sKYXk5a9JDZv6Zz42Hpqsm8WSXq
hAkriTtiKsRY/LUwEMrobsVXECd9lmBFbhCRtvsyzAE8od6fCjTDhKN2iprEbQID
AQABo4GVMIGSMA4GA1UdDwEB/wQEAwIFoDATBgNVHSUEDDAKBggrBgEFBQcDATAM
BgNVHRMBAf8EAjAAMB0GA1UdDgQWBBS6+gMY818Pp8xhCesKEQMM4DyQUDAfBgNV
HSMEGDAWgBSgjXTwjh3EXSfzClruDxble1H3rzAdBgNVHREEFjAUghIqLmFwcHMt
Y3JjLnRlc3RpbmcwDQYJKoZIhvcNAQELBQADggEBAFLqT+vrGBE/eVwZJVd130j5
V/FHudbQZtwb+88igtmPxM04HUncAGexfAIysAuQ7qclLMzgQY050qomKvp/VX+N
IUNDVG31gOdS9JnL0bTQ3oGUahruCKPDKCg3Ic/op4+Zs6g9KPHEEBrWeYJwRJ5R
S6dWnTysvw138Gj6b8iu4S0TTG/cHAbxYq3n0t4XLnNiCTIdlo84VuG3c2ISqnpj
bxWFplcp64ZwNWcReHu9rT8Hj2boqX9QRlP0EAfwJ6CQ+bvpXKMHeJliyULm9b9u
aQx8Jw/dzAGThZpAp0nLZF/mz4AHc3WQ+dOx+GrKyf/fhOu2THZSIEQ5rZxTwdM=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDDDCCAfSgAwIBAgIBATANBgkqhkiG9w0BAQsFADAmMSQwIgYDVQQDDBtpbmdy
ZXNzLW9wZXJhdG9yQDE2NzU3NDI2MjgwHhcNMjMwMjA3MDQwMzQ3WhcNMjUwMjA2
MDQwMzQ4WjAmMSQwIgYDVQQDDBtpbmdyZXNzLW9wZXJhdG9yQDE2NzU3NDI2Mjgw
ggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCyBVzvAL8fa3JR5LlRG3W9
Vq9urdGUztYH/T+59sBrxy95vb1xeCRoiGIOBAnJ1Y6moZLtpTdEag/bEQgCwjhh
tRaT36JVeXSaQV2lLZ+ox7no9OYbOWqnM45ry+T4R06Ar3T/ZOnaIpAN2kUUuVrL
ekSlZuUoNjOtT63mopl25o1LTZFsGFuDrbuE19155dmXy4YxVUKnefyOxP5zWb42
vLKIe8VAuC3c96Q0Qxq5tfsUYCgEOnCP/BT57zVkG91r4JTUl091Y+ymCx4Q/nGZ
BCGvjooz53YKUHXpHHUjbRhiEhGiaowPnCOhoH8kxRCAM9I7KTPTQb5CEc+LSOLH
AgMBAAGjRTBDMA4GA1UdDwEB/wQEAwICpDASBgNVHRMBAf8ECDAGAQH/AgEAMB0G
A1UdDgQWBBSgjXTwjh3EXSfzClruDxble1H3rzANBgkqhkiG9w0BAQsFAAOCAQEA
WxgBjd2HcMNap3O8bqRKiCmH4jZfu3zQd7zUSmTpbUgQagog6ngcvPnDbCdr1s45
UaFXSW7oezG6XnQuXYqSgC2JW1n9CBo5YrtRbdpyTou1rJkRGPo7QOPBpnwKpIqm
n3o/cKviY4oRW8NZuNXlyPNnQAcjsrQUTQY5TiTIHnk6JE/OiFa80VP7hC+adz/d
ZyJT7TPAxHhICyPKkLGbCkj+abauKJsC6etaW5fU/aME3vw2r47ZtLIiZmY5rqYs
30lOY2j8hywwR5UJ1OVKGBAusXeyJddtBx6YjR79/vsAkRq7lOPJBPg3be7FQvoA
ve4ujNLo8Yf6M9CVfa0Lyg==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDQDCCAiigAwIBAgIIdr2FiczCgvgwDQYJKoZIhvcNAQELBQAwPjESMBAGA1UE
CxMJb3BlbnNoaWZ0MSgwJgYDVQQDEx9rdWJlLWFwaXNlcnZlci1sb2NhbGhvc3Qt
c2lnbmVyMB4XDTIzMDIwNzAzNTgyOFoXDTMzMDIwNDAzNTgyOFowPjESMBAGA1UE
CxMJb3BlbnNoaWZ0MSgwJgYDVQQDEx9rdWJlLWFwaXNlcnZlci1sb2NhbGhvc3Qt
c2lnbmVyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5lvOoqwOzrJP
7a3H/McrmJp3GI5UsmFoBv79jpdcDIJf0qkcg8k4jdWOvzsqiMFFXltBgPB+bKUM
Qxd8zZFeFHWu9xMzcTW2N+7qrBu6Q4jmMvbEFrR5frZVhdqiKh1v0F2G+mJM2bLn
N75MpT4bceyIFhBX5ofLj057DcRZtqFM70xR0yeQcNwdeLzwk3awz3wFXGMARrFI
k7CliLjlb+8VblwYBRhbIaoMECZ5+tBPLIuLCmdlremZa0OzyGcUbtQOO/SmhTEF
6KMwnyj0OWki3Rm1qdBV+UaQdvkxSYZadXIeDh1w6zZv8DP1mM5zW2XkO/Tx/Pu1
s99GLMk9NQIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAqQwDwYDVR0TAQH/BAUwAwEB
/zAdBgNVHQ4EFgQUhwsweT50ri7fvtHxubE9Pe03hmcwDQYJKoZIhvcNAQELBQAD
ggEBAMJTXg6XRVdc71+3DL42ZkpnMELxhTZnC6+QEXVZlLbfcqrLD8jO+iGvvlLn
e3omGqlpJ5d5FTNRWmrjDRZAUic9Xd8t+eI6MCvNg4GSzRacHB7nXCNjOxi2uVPR
OHQ/JlgqZKxUUQe21xcCjA6V2Vc+myBnchOtPcLGachHsk1sWAuZKjy7RfVeyoUt
S9Nzpqe2o1qL1CMtqIjli+9KTv5qdo8osJu1PznaZUN4o2uR2vM2sfE0ymYI+Nwj
Selj14vAM4E01hwns+5CtzgJo24iF9VUxcZ3ISJ4DJh+tiR9vocNMt+lZCuljM1j
Z3wkb6SuQbx4RHRzYCACSwguRnA=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDTDCCAjSgAwIBAgIIOTO79jF91xcwDQYJKoZIhvcNAQELBQAwRDESMBAGA1UE
CxMJb3BlbnNoaWZ0MS4wLAYDVQQDEyVrdWJlLWFwaXNlcnZlci1zZXJ2aWNlLW5l
dHdvcmstc2lnbmVyMB4XDTIzMDIwNzAzNTgyOVoXDTMzMDIwNDAzNTgyOVowRDES
MBAGA1UECxMJb3BlbnNoaWZ0MS4wLAYDVQQDEyVrdWJlLWFwaXNlcnZlci1zZXJ2
aWNlLW5ldHdvcmstc2lnbmVyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC
AQEA3090OgWTZL2qAslIUjBDXuF3fs5BzvNpUvDdfKqz+XLw21WTmly/dZXSqCHT
M1QK/X2hFfMYduciYZn43s8z7CqfwXO72A+OUZnjvWU66Z95gTzkmxjndv7tVMDV
3XS904a1NMgNKmZMW8DuLPPV3d+ENdUq1DCA1zuw+Uk98lp/EmuUYaJNJ/5q6MWz
gTGo1ck4SgegExk9gTnx9QOI0JloNhJfD/CUTgSLY67zbFsvxko5VHaIIlDRAahB
ENj0atSIHD2Mq/K9KuCdUkN/LcYRkRuzrJfTmeofVM8IZibr+L7Du+Urg7iVA7Vz
izcWKLB9dfVbZ4p2KVJyGjD2SwIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAqQwDwYD
VR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUbBp1kdnBXNGNnN/LpOp4bBvD6Y8wDQYJ
KoZIhvcNAQELBQADggEBAHjjL8NHBUg91Vx8WOg2fWLyaovXu2f71sVwyvAKhPka
lStC2pL57wnoaDenvJWW2Z38+wZTQxp4FBLWiJlyAiDF07bqeDt+fepBGuQ81lWO
e1LDcdzZrlHYgYSakk6YslJK47zeIQSLy4USaPypijaAZe9U6Iavwv+8ilCoDxI9
dCc489fgEb3FvDcWTDats5HuptJcQHS8w9XVZj0wUDbGrwrZVmksLJFjQNMCSt4q
61KHekFD/Y9Qws/LApJv6MqEEabZu6c6llfPzbM21YtHgdwnHQs//r3qzOv2/QPu
/PudFEFQWU97OO7BITZ0n/vUhJB5Iy6oo1rb5u+Np/A=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDMjCCAhqgAwIBAgIIG5qdGFg0fLkwDQYJKoZIhvcNAQELBQAwNzESMBAGA1UE
CxMJb3BlbnNoaWZ0MSEwHwYDVQQDExhrdWJlLWFwaXNlcnZlci1sYi1zaWduZXIw
HhcNMjMwMjA3MDM1ODI5WhcNMzMwMjA0MDM1ODI5WjA3MRIwEAYDVQQLEwlvcGVu
c2hpZnQxITAfBgNVBAMTGGt1YmUtYXBpc2VydmVyLWxiLXNpZ25lcjCCASIwDQYJ
KoZIhvcNAQEBBQADggEPADCCAQoCggEBAOWbjQRuC7FB5bKS3VGAPWiV8/tpLDHa
VYbytqQdq/jGK5zDxhCMkGHTRD+Yn2Cu490HMC4XdsHRPAd9MTz8EcwRDA9DokJr
EADdnv7LB80SzFG67uPMaY8LtZl540xivtFghPmwYeIz8XWLgALn8tu6qIleat+L
D2YtWDgpcOorGMyiCVA78bqpH0Suo81DPm+vGz8b6gl2/+TLaJVBeZJzv90gL2GS
wtsVqwuuHwTZvbvvqD6GKhk+fISQZglGYyEtllTHj5fXYqi+KCAhTIRDE4S7digp
ZuFQLTj1yRHfkq0qOEa30HrYR1s1nXE1mhuL72+cMdscRd/5cG4MitcCAwEAAaNC
MEAwDgYDVR0PAQH/BAQDAgKkMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFLeq
GFu178/6ob5hBdmiR9WuDsZLMA0GCSqGSIb3DQEBCwUAA4IBAQCt1ewO+7rWZZis
vat5OgFDM0qMJaYDpsAKIo5SDJYpbzqTSqSs0SNQxBkcDLHMDy2kKsChrdCfBIu1
4/wpFbJUBIvX7rT4OgmKQUCh54/qebbtR8t8Wfs4zr/NgqUpENzVgaiKafOnxY73
TLHVAdl7IgeD2AWkliltHVBouYs/Jn93rQb+bmtvJgGzrCdWIsY7LrcFzwE8wpQA
70RN57RE29txzuQ0/lJfMIsZF10xq2+eNz/iPKmQ+PXZXF5DP99t4rknpkKno+o2
lqTuJYYN/5H0n2fEk3CW6y0M1vL8gXqLN4YEgmLoBvjrrNxrgYjT4kcUt1ZN/8yV
Mj1kbN2K
-----END CERTIFICATE-----" \
     issuer="https://kubernetes.default.svc.cluster.local"


echo '{"apiVersion": "authentication.k8s.io/v1", "kind": "TokenRequest"}' \
  | oc create -f- --raw /api/v1/namespaces/default/serviceaccounts/default/token \
  | jq -r '.status.token' \
  | cut -d . -f2 \
  | base64 -d
